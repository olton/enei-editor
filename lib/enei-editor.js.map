{"version":3,"file":"enei-editor.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import \"./index.less\"\r\n\r\nif (!globalThis.eneiEditorKey) {\r\n    globalThis.eneiEditorKey = `ctr+alt+k`\r\n}\r\n\r\nconst ENEI_EDITOR_MODE_CLASS = 'enei_editor_mode'\r\nconst ENEI_EDITOR_TARGET_CLASS = '[enei]'\r\n\r\nconst EDITOR_HTML = `\r\n<div class=\"enei__text\" contenteditable=\"true\"></div>\r\n<div class=\"enei__actions\">\r\n    <button class=\"enei__button js-enei-ok\">OK</button>\r\n    <button class=\"enei__button js-enei-cancel\">Cancel</button>\r\n</div>\r\n`\r\n\r\nclass EneiEditor {\r\n    body = null\r\n    editor = null\r\n    overlay = null\r\n    content = null\r\n\r\n    constructor() {\r\n        this.addEvents()\r\n        this.body = document.querySelector(\"body\")\r\n    }\r\n\r\n    createEditor(){\r\n        console.log(\"Create Editor\")\r\n        this.editor = document.createElement(\"div\")\r\n        this.editor.className = 'enei__editor'\r\n        this.editor.innerHTML = EDITOR_HTML\r\n        this.overlay.append(this.editor)\r\n    }\r\n\r\n    createOverlay(){\r\n        console.log(\"Create Overlay\")\r\n        this.overlay = document.createElement(\"div\")\r\n        this.overlay.classList.add(\"enei__overlay\")\r\n        this.body.append(this.overlay)\r\n    }\r\n\r\n    openEditor(forElement){\r\n        const self = this\r\n        const content = forElement.innerHTML\r\n        const rect = forElement.getBoundingClientRect()\r\n        this.createOverlay()\r\n        this.createEditor()\r\n        this.editor.style.top = `${rect.top}px`\r\n        this.editor.style.left = `${rect.left}px`\r\n        this.editor.style.width = `${rect.width}px`\r\n        this.editor.style.height = `${rect.height + 28}px`\r\n        this.content = this.editor.querySelector(\".enei__text\")\r\n        this.content.innerHTML = content\r\n        this.content.focus()\r\n        this.content.addEventListener(\"input\", () => {\r\n            const h = this.content.scrollHeight + 42\r\n            self.editor.style.height = `${h}px`\r\n        })\r\n        this.editor.querySelector(\".js-enei-cancel\").addEventListener(\"click\", () => {\r\n            this.overlay.remove()\r\n        })\r\n        this.editor.querySelector(\".js-enei-ok\").addEventListener(\"click\", () => {\r\n            forElement.innerHTML = this.content.innerHTML\r\n            this.overlay.remove()\r\n        })\r\n    }\r\n\r\n    addEvents(){\r\n        const self = this\r\n\r\n        window.addEventListener(\"keydown\", function(event){\r\n            if (event.repeat) return\r\n\r\n            const keys = []\r\n\r\n            if (event.ctrlKey || event.metaKey) keys.push('ctr')\r\n            if (event.altKey) keys.push('alt')\r\n            if (event.shiftKey) keys.push('shift')\r\n            if (event.key) keys.push(event.key)\r\n\r\n            if ( eneiEditorKey === keys.join(\"+\") ) {\r\n                self.switchMode()\r\n            }\r\n        })\r\n\r\n        const elements = document.querySelectorAll(ENEI_EDITOR_TARGET_CLASS)\r\n\r\n        const clickHandler = function(event) {\r\n            if(!self.inEditMode()) return\r\n            self.openEditor(this)\r\n        }\r\n\r\n        elements.forEach(el => {\r\n            el.addEventListener(\"click\", clickHandler)\r\n        })\r\n    }\r\n\r\n    switchMode(){\r\n        this.body.classList.toggle(ENEI_EDITOR_MODE_CLASS)\r\n    }\r\n\r\n    inEditMode(){\r\n        return this.body.classList.contains(ENEI_EDITOR_MODE_CLASS)\r\n    }\r\n}\r\n\r\nnew EneiEditor()\r\n"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","globalThis","eneiEditorKey","ENEI_EDITOR_MODE_CLASS","body","editor","overlay","content","constructor","this","addEvents","querySelector","createEditor","console","log","className","innerHTML","append","createOverlay","classList","add","openEditor","forElement","self","rect","getBoundingClientRect","top","left","width","height","focus","addEventListener","h","scrollHeight","remove","window","event","repeat","keys","ctrlKey","metaKey","push","altKey","shiftKey","key","join","switchMode","elements","querySelectorAll","clickHandler","inEditMode","forEach","el","toggle","contains"],"mappings":";;;;;0BAAA,SAAqBA,EAAKC,QACX,IAARA,IAAiBA,EAAM,CAAA,GAC5B,IAAIC,EAAWD,EAAIC,SAEnB,GAAKF,GAA2B,oBAAbG,SAAnB,CAEA,IAAIC,EAAOD,SAASC,MAAQD,SAASE,qBAAqB,QAAQ,GAC9DC,EAAQH,SAASI,cAAc,SACnCD,EAAME,KAAO,WAEI,QAAbN,GACEE,EAAKK,WACPL,EAAKM,aAAaJ,EAAOF,EAAKK,YAKhCL,EAAKO,YAAYL,GAGfA,EAAMM,WACRN,EAAMM,WAAWC,QAAUb,EAE3BM,EAAMK,YAAYR,SAASW,eAAed,GAnBY,CAqB1D,yyFCvBKe,WAAWC,gBACZD,WAAWC,cAAgB,aAG/B,MAAMC,EAAyB,mBAsG/B,IA3FA,MACIC,KAAO,KACPC,OAAS,KACTC,QAAU,KACVC,QAAU,KAEV,WAAAC,GACIC,KAAKC,YACLD,KAAKL,KAAOf,SAASsB,cAAc,OACtC,CAED,YAAAC,GACIC,QAAQC,IAAI,iBACZL,KAAKJ,OAAShB,SAASI,cAAc,OACrCgB,KAAKJ,OAAOU,UAAY,eACxBN,KAAKJ,OAAOW,UAvBA,2NAwBZP,KAAKH,QAAQW,OAAOR,KAAKJ,OAC5B,CAED,aAAAa,GACIL,QAAQC,IAAI,kBACZL,KAAKH,QAAUjB,SAASI,cAAc,OACtCgB,KAAKH,QAAQa,UAAUC,IAAI,iBAC3BX,KAAKL,KAAKa,OAAOR,KAAKH,QACzB,CAED,UAAAe,CAAWC,GACP,MAAMC,EAAOd,KACPF,EAAUe,EAAWN,UACrBQ,EAAOF,EAAWG,wBACxBhB,KAAKS,gBACLT,KAAKG,eACLH,KAAKJ,OAAOb,MAAMkC,IAAM,GAAGF,EAAKE,QAChCjB,KAAKJ,OAAOb,MAAMmC,KAAO,GAAGH,EAAKG,SACjClB,KAAKJ,OAAOb,MAAMoC,MAAQ,GAAGJ,EAAKI,UAClCnB,KAAKJ,OAAOb,MAAMqC,OAAS,GAAGL,EAAKK,OAAS,OAC5CpB,KAAKF,QAAUE,KAAKJ,OAAOM,cAAc,eACzCF,KAAKF,QAAQS,UAAYT,EACzBE,KAAKF,QAAQuB,QACbrB,KAAKF,QAAQwB,iBAAiB,SAAS,KACnC,MAAMC,EAAIvB,KAAKF,QAAQ0B,aAAe,GACtCV,EAAKlB,OAAOb,MAAMqC,OAAS,GAAGG,KAAK,IAEvCvB,KAAKJ,OAAOM,cAAc,mBAAmBoB,iBAAiB,SAAS,KACnEtB,KAAKH,QAAQ4B,QAAQ,IAEzBzB,KAAKJ,OAAOM,cAAc,eAAeoB,iBAAiB,SAAS,KAC/DT,EAAWN,UAAYP,KAAKF,QAAQS,UACpCP,KAAKH,QAAQ4B,QAAQ,GAE5B,CAED,SAAAxB,GACI,MAAMa,EAAOd,KAEb0B,OAAOJ,iBAAiB,WAAW,SAASK,GACxC,GAAIA,EAAMC,OAAQ,OAElB,MAAMC,EAAO,IAETF,EAAMG,SAAWH,EAAMI,UAASF,EAAKG,KAAK,OAC1CL,EAAMM,QAAQJ,EAAKG,KAAK,OACxBL,EAAMO,UAAUL,EAAKG,KAAK,SAC1BL,EAAMQ,KAAKN,EAAKG,KAAKL,EAAMQ,KAE1B1C,gBAAkBoC,EAAKO,KAAK,MAC7BtB,EAAKuB,YAErB,IAEQ,MAAMC,EAAW1D,SAAS2D,iBAhFD,UAkFnBC,EAAe,SAASb,GACtBb,EAAK2B,cACT3B,EAAKF,WAAWZ,KACnB,EAEDsC,EAASI,SAAQC,IACbA,EAAGrB,iBAAiB,QAASkB,EAAa,GAEjD,CAED,UAAAH,GACIrC,KAAKL,KAAKe,UAAUkC,OAAOlD,EAC9B,CAED,UAAA+C,GACI,OAAOzC,KAAKL,KAAKe,UAAUmC,SAASnD,EACvC","x_google_ignoreList":[0]}